<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Login to your Moueene account" />
    <title>Login - Moueene</title>
    <link rel="icon" type="image/png" href="../logo.png" />
    <link rel="stylesheet" href="../assets/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <nav class="navbar">
          <a href="../index.html" class="logo">
            <img src="../logo.png" alt="Moueene Logo" />
          </a>
          <ul class="nav-menu">
            <li><a href="../index.html">Home</a></li>
            <li><a href="services.html">Services</a></li>
            <li><a href="providers.html">Providers</a></li>
            <li><a href="how-it-works.html">How It Works</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
          <div class="nav-buttons">
            <a href="login.html" class="btn btn-outline">Login</a>
            <a href="register.html" class="btn btn-primary">Sign Up</a>
          </div>
          <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </nav>
      </div>
    </header>

    <!-- Auth Section -->
    <section class="auth-section">
      <div class="container">
        <div class="auth-container">
          <div class="auth-image">
            <h2>Welcome Back!</h2>
            <p>
              Login to access your account, manage bookings, and connect with
              service providers.
            </p>
            <div style="margin-top: 40px">
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 15px;
                  margin-bottom: 20px;
                "
              >
                <i class="fas fa-check-circle" style="font-size: 1.5rem"></i>
                <span>Access your bookings</span>
              </div>
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 15px;
                  margin-bottom: 20px;
                "
              >
                <i class="fas fa-check-circle" style="font-size: 1.5rem"></i>
                <span>Message providers directly</span>
              </div>
              <div style="display: flex; align-items: center; gap: 15px">
                <i class="fas fa-check-circle" style="font-size: 1.5rem"></i>
                <span>Save your favorite providers</span>
              </div>
            </div>
          </div>
          <div class="auth-form-container">
            <div class="auth-logo">
              <img src="../logo.png" alt="Moueene Logo" />
            </div>
            <div class="auth-form">
              <h2>Sign In</h2>
              <form action="#" method="POST" data-validate>
                <div class="form-group">
                  <label for="email">Email Address</label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    autocomplete="email"
                    placeholder="Enter your email"
                  />
                </div>
                <div class="form-group">
                  <label for="password">Password</label>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    autocomplete="current-password"
                    placeholder="Enter your password"
                  />
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                  "
                >
                  <div class="form-check">
                    <input type="checkbox" id="remember" name="remember" />
                    <label for="remember">Remember me</label>
                  </div>
                  <a
                    href="forgot-password.html"
                    style="color: var(--primary-color)"
                    >Forgot Password?</a
                  >
                </div>
                <button
                  type="submit"
                  class="btn btn-primary btn-lg"
                  style="width: 100%"
                >
                  Sign In
                </button>
              </form>

              <div style="text-align: center; margin: 30px 0">
                <span style="color: var(--text-light)">Or continue with</span>
              </div>

              <div style="display: flex; gap: 15px; margin-bottom: 30px">
                <button
                  class="btn btn-outline"
                  style="
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                  "
                >
                  <i class="fab fa-google"></i> Google
                </button>
                <button
                  class="btn btn-outline"
                  style="
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                  "
                >
                  <i class="fab fa-facebook-f"></i> Facebook
                </button>
              </div>

              <div class="auth-links">
                <p>
                  Don't have an account? <a href="register.html">Sign Up</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer" style="margin-top: 0">
      <div class="container">
        <div class="footer-bottom" style="border-top: none; padding: 25px 0">
          <p>&copy; 2026 Moueene. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script>
      // Redirect if already logged in
      if (Auth.isAuthenticated()) {
        Auth.redirectToDashboard();
      }

      // Handle login form submission
      const loginForm = document.querySelector("form[data-validate]");
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Get form data
        const formData = new FormData(loginForm);
        const email = formData.get("email");
        const password = formData.get("password");
        const rememberMe = formData.get("remember") === "on";

        // Validate email
        if (!email || !email.includes("@")) {
          await Auth.showModal({
            type: "warning",
            title: "Invalid email",
            message: "Please enter a valid email address.",
          });
          return;
        }

        // Validate password
        if (!password) {
          await Auth.showModal({
            type: "warning",
            title: "Missing password",
            message: "Please enter your password.",
          });
          return;
        }

        // Check URL for user type parameter, default to 'user'
        const urlParams = new URLSearchParams(window.location.search);
        const userType = urlParams.get("type") || "user";

        // Prepare login data
        const credentials = {
          email: email,
          password: password,
          user_type: userType,
          remember_me: rememberMe,
        };

        // Show loading state
        const submitButton = loginForm.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Signing In...';

        // Call login API
        const result = await Auth.login(credentials);

        if (result.success) {
          // Show success message
          await Auth.showModal({
            type: "success",
            title: "Welcome back",
            message: result.message || "Login successful!",
          });
          // Redirect to dashboard
          Auth.redirectToDashboard();
        } else {
          // Show error message
          await Auth.showModal({
            type: "error",
            title: "Login failed",
            message:
              result.message || "Login failed. Please check your credentials.",
          });
          // Reset button
          submitButton.disabled = false;
          submitButton.textContent = originalText;
        }
      });

      // Add user type selector in UI
      const authForm = document.querySelector(".auth-form");
      const userTypeSelector = document.createElement("div");
      userTypeSelector.style.marginBottom = "20px";
      userTypeSelector.innerHTML = `
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <label class="user-type-btn" style="flex: 1; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s;">
            <input type="radio" name="login_type" value="user" checked style="display: none;" />
            <i class="fas fa-user" style="margin-right: 5px;"></i>
            Customer
          </label>
          <label class="user-type-btn" style="flex: 1; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s;">
            <input type="radio" name="login_type" value="provider" style="display: none;" />
            <i class="fas fa-user-tie" style="margin-right: 5px;"></i>
            Provider
          </label>
        </div>
      `;
      authForm.insertBefore(userTypeSelector, loginForm);

      // Handle user type selection
      document.querySelectorAll(".user-type-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          document.querySelectorAll(".user-type-btn").forEach((b) => {
            b.style.borderColor = "var(--border-color)";
            b.style.background = "transparent";
          });
          this.style.borderColor = "var(--primary-color)";
          this.style.background = "rgba(0, 201, 167, 0.1)";

          // Update URL parameter
          const selectedType = this.querySelector("input").value;
          const url = new URL(window.location);
          url.searchParams.set("type", selectedType);
          window.history.replaceState({}, "", url);
        });
      });

      // Initialize selected type from URL
      const urlParams = new URLSearchParams(window.location.search);
      const initialType = urlParams.get("type") || "user";
      const initialBtn = document.querySelector(
        `input[value="${initialType}"]`,
      )?.parentElement;
      if (initialBtn) {
        initialBtn.click();
      } else {
        document.querySelector(".user-type-btn").click();
      }
    </script>
  </body>
</html>
